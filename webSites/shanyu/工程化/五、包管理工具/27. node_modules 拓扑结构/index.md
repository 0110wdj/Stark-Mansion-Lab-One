[原文](https://juejin.cn/post/7030084290989948935)

### npmv2

结构 1：

```
- package-a
  - `lodash@^4.17.4`
- package-b
  - `lodash@^4.16.1`
```

```json
{
  "node_modules": [
    ["package-a", "lodash@4.17.4"],
    ["package-b", "lodash@4.17.4"]
  ]
}
```

### npmv3

结构 1：

```
- package-a
  - `lodash@^4.17.4`
- package-b
  - `lodash@^4.16.1`
```

```json
{
  "node_modules": ["package-a", "package-b", "lodash@4.17.4"]
}
```

结构 2：

```
- package-a
  - `lodash@4.17.4`
- package-b
  - `lodash@4.16.1`
```

```json
{
  "node_modules": [
    "package-a",
    ["package-b", "lodash@4.16.1"],
    "lodash@^4.17.4"
  ]
}
```

结构 3：

```
- package-a
  - `lodash@4.0.0`
- package-b
  - `lodash@4.0.0`
- package-c
  - `lodash@3.0.0`
- package-d
  - `lodash@3.0.0`
```

```json
{
  "node_modules": [
    "package-a",
    "package-b",
    ["package-c", "lodash@3.0.0"],
    ["package-d", "lodash@3.0.0"],
    "lodash@4.0.0"
  ]
}
```

### 存在的问题

- Install Size，安装体积变大，浪费磁盘空间
- Build Size，构建打包体积变大，浪费带宽，网站打开延迟，破坏用户体验 (PS: 支持 Tree Shaking 会好点)
- 破坏单例模式，破坏缓存，如 postcss 的许多插件将 postcss 扔进 dependencies，重复的版本将导致解析 AST 多次
